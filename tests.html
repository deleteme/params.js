<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" type="text/css" media="screen" />
  <script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>
  <script src="params.js" type="text/javascript" charset="utf-8"></script>
  <script>
  $(document).ready(function(){

    var cheapcadaversURL = "http://www.cheapcadavers.com/?rick=moranis&bumblebee=tuna&hash[some_key]=someValue";
    var stubLocation = {
      href:     cheapcadaversURL,
      search:   "?rick=moranis&bumblebee=tuna&hash[some_key]=someValue",
      protocol: "http:",
      host:     "www.cheapcadavers.com",
      pathname: "/"
    };

    test("Can be instantiated with an optional _location argument", function(){
      expect(2);
      ok(new Params(stubLocation), "We expect it not to error with a location.");
      ok(new Params(), "We expect it not to error without a location.");
    });

    var params = new Params(stubLocation);

    test("url() should return the private Params URL", function(){
      expect(1);
      equals(params.url(), cheapcadaversURL);
    });

    module("Reading Params");

    test("Knows about existing params on init.", function(){
      expect(3);
      equals(params.get('rick'), 'moranis');
      equals(params.get('bumblebee'), 'tuna');
      equals(params.get('hash[some_key]'), 'someValue');
    });

    test("Returns undefined for undefined keys.", function(){
      expect(1);
      equals(params.get('sandwich'), undefined);
    });

    module("Setting Params");

    test("Returns the value it's setting.", function(){
      expect(1);
      equals(params.set('loser', 'baby'), 'baby');
    });

    test("Returns an object if it took one.", function(){
      expect(1);
      var blort = {
        smoo: 123,
        lamb: 'da'
      };
      equals(params.set(blort), blort);
    });

    test("Can set a single param pair, and get it back out.", function(){
      expect(2);
      var target = params.set('lazer', 'gunz');
      equals(params.get('lazer'), target);
      notEqual(params.get('lazer'), undefined);
    });

    module('Building URL');
    var building = new Params(stubLocation);

    test("url() should return an href with the updated params.", function(){
      expect(1);
      building.set('sky', 'blue');
      equals(building.url(), stubLocation.href + '&sky=blue');
    });

    module('Reducing URL Params');

    test("unset() should return value of key being removed.", function(){
      expect(1);
      equals(building.unset('sky'), 'blue');
    });

    test("url() should not include a key that has been removed.", function(){
      expect(4);
      equals(building.url(), stubLocation.href);

      building.unset('rick');
      equals(building.url(), "http://www.cheapcadavers.com/?bumblebee=tuna&hash[some_key]=someValue");

      building.unset('hash[some_key]');
      equals(building.url(), "http://www.cheapcadavers.com/?bumblebee=tuna");

      building.unset('bumblebee');
      equals(building.url(), "http://www.cheapcadavers.com/");
    });


    });
  </script>
  
</head>
<body>
  <h1 id="qunit-header">QUnit example</h1>
  <h2 id="qunit-banner"></h2>
  <div id="qunit-testrunner-toolbar"></div>
  <h2 id="qunit-userAgent"></h2>
  <ol id="qunit-tests"></ol>
  <div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>

